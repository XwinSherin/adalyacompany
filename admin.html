<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Admin Paneli</title>
  <style>
    :root{--gold:#d4af37;--gold-dark:#b8941f;--bg:#f5f7fa;--surface:#fff;--text:#2c3e50;--error:#e74c3c;--border:#e0e0e0;--g50:#e8f5e9;--g250:#ffebee;--g1000:#e3f2fd;--radius:16px;--shadow:0 6px 20px rgba(0,0,0,.08)}
    *{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif}
    body{background:var(--bg);color:var(--text)}

    /* ÜST BAR – MODERN */
    .top-bar{display:flex;align-items:center;justify-content:space-between;padding:16px;background:var(--surface);box-shadow:var(--shadow);position:sticky;top:0;z-index:990}
    .logo-name{display:flex;align-items:center;gap:12px}
    .logo-name img{height:48px;border-radius:12px}
    .logo-name .company{font-size:1.2rem;font-weight:700;letter-spacing:.5px}
    .logout-btn{background:var(--error);color:#fff;border:none;border-radius:var(--radius);padding:10px 16px;font-size:.85rem;font-weight:600;cursor:pointer;transition:background .2s}
    .logout-btn:hover{background:#c0392b}

    /* SEKMELER – MODERN */
    .tabs{display:flex;gap:6px;padding:10px 16px;background:var(--surface);position:sticky;top:76px;z-index:980}
    .tab{flex:1;padding:12px;border:none;border-radius:var(--radius);font-size:.9rem;font-weight:600;cursor:pointer;background:#eee;color:var(--text);transition:background .2s}
    .tab.active{background:var(--gold);color:#fff;box-shadow:0 2px 8px rgba(212,175,55,.3)}

    /* İÇERİK – MODERN */
    .content{padding:16px;max-width:900px;margin:auto}
    .section{display:none}
    .section.active{display:block}

    /* BUTONLAR – MODERN */
    .btn-modern{display:inline-flex;align-items:center;gap:8px;padding:12px 20px;border:none;border-radius:var(--radius);font-size:.9rem;font-weight:600;cursor:pointer;transition:transform .2s}
    .btn-modern:active{transform:scale(.96)}
    .btn-primary{background:var(--gold);color:#fff;box-shadow:0 2px 8px rgba(212,175,55,.3)}
    .btn-secondary{background:#eee;color:var(--text)}

    /* TABLO – ÇİZGİLİ + BINLİK AYIRAC */
    .table-container{background:var(--surface);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin-bottom:16px}
    .filter-input{width:100%;max-width:300px;padding:10px;border:1.5px solid var(--border);border-radius:var(--radius);font-size:.85rem;margin-bottom:12px}
    table{width:100%;border-collapse:collapse;font-size:.85rem}
    th,td{padding:10px;text-align:center;border:1px solid var(--border)}
    th{background:var(--bg);font-weight:700}
    tr:nth-child(even){background:var(--bg)}
    .actions{display:flex;gap:6px;justify-content:center}
    .actions button{padding:6px 10px;border:none;border-radius:6px;font-size:.75rem;cursor:pointer}
    .edit-btn{background:var(--gold);color:#fff}
    .del-btn{background:var(--error);color:#fff}

    /* LİSTE – SIRALAMALI */
    .list{display:flex;flex-direction:column;gap:12px}
    .item{background:var(--surface);border-radius:var(--radius);box-shadow:var(--shadow);padding:12px;display:flex;align-items:center;gap:12px;cursor:grab}
    .item.dragging{opacity:.6;cursor:grabbing}
    .item img{width:64px;height:64px;object-fit:cover;border-radius:8px}
    .item .info{flex:1;font-size:.9rem}
    .item .info .name{font-weight:700}
    .item .info .sub{color:var(--text);opacity:.7}

    /* MODAL – MODERN */
    .modal{display:none;position:fixed;inset:0;z-index:2000;background:rgba(0,0,0,.45);align-items:center;justify-content:center;padding:16px}
    .modal.show{display:flex}
    .modal-content{background:var(--surface);border-radius:var(--radius);width:100%;max-width:420px;max-height:90vh;overflow-y:auto;box-shadow:0 8px 30px rgba(0,0,0,.2);display:flex;flex-direction:column}
    .modal-header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--border)}
    .modal-header h2{font-size:1.2rem;font-weight:700}
    .close-modal{background:none;border:none;font-size:1.4rem;cursor:pointer;color:var(--text)}
    .modal-body{padding:16px;font-size:.85rem;line-height:1.5;display:flex;flex-direction:column;gap:10px}
    .modal-footer{display:flex;gap:8px;padding:12px 16px;border-top:1px solid var(--border)}
    .modal-footer button{flex:1;padding:10px;border:none;border-radius:var(--radius);font-size:.85rem;font-weight:600;cursor:pointer}
    .save-btn{background:var(--gold);color:#fff}
    .cancel-btn{background:#eee;color:var(--text)}

    /* EXCEL CDN */
    script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js';
    document.head.appendChild(script);
</style>
</head>
<body>

<!-- ÜST BAR – MODERN -->
<header class="top-bar">
  <div class="logo-name">
    <img src="img/adalyalogo.jpg" alt="Logo">
    <span class="company">Adalya Company</span>
  </div>
  <button class="logout-btn" onclick="cikis()">Çıkış</button>
</header>

<!-- SEKMELER – MODERN -->
<div class="tabs">
  <button class="tab active" onclick="changeTab('orders')">Siparişler</button>
  <button class="tab" onclick="changeTab('products')">Ürünler</button>
  <button class="tab" onclick="changeTab('users')">Kullanıcılar</button>
</div>

<!-- İÇERİK – MODERN -->
<div class="content">
  <!-- SİPARİŞLER – ÇİZGİLİ TABLO + FİLTRE + SÜTUN TOPLAMLARI -->
  <section id="orders" class="section active">
    <h3>Siparişler</h3>
    <div class="table-container">
      <input type="text" class="filter-input" id="orderFilter" placeholder="Müşteri adı veya sipariş kodu ara..." oninput="filterOrders()">
      <table id="ordersTable">
        <thead>
          <tr>
                <th>Müşteri</th>
                <th>Kod</th>
                <th>Gönderim</th>
                <th style="background:var(--g50)">50G</th>
                <th style="background:var(--g250)">250G</th>
                <th style="background:var(--g1000)">1000G</th>
                <th>Toplam Koli</th>
                <th>Toplam KG</th>
                <th>İşlem</th>
          </tr>
        </thead>
        <tbody id="ordersBody"></tbody>
      </table>
    </div>
  </section>

  <!-- ÜRÜNLER – SIRALAMALI LİSTE -->
  <section id="products" class="section">
    <h3>Ürünler</h3>
    <button class="btn-modern btn-primary" onclick="openProductForm()">+ Yeni Ürün Ekle</button>
    <div class="list" id="productsList"></div>
  </section>

  <!-- KULLANICILAR – VARSAYILAN ŞİFRE "Adalya" -->
  <section id="users" class="section">
    <h3>Kullanıcılar</h3>
    <button class="btn-modern btn-primary" onclick="openUserForm()">+ Yeni Kullanıcı Ekle</button>
    <div class="list" id="usersList"></div>
  </section>
</div>

<!-- MODAL – MODERN -->
<div class="modal" id="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modalTitle">Modal</h2>
      <button class="close-modal" onclick="closeModal()">&times;</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
    <div class="modal-footer" id="modalFooter"></div>
  </div>
</div>

<script>
  const KOLI_KG = 6;
  let orders = JSON.parse(localStorage.getItem('orders') || '[]');
  let products = JSON.parse(localStorage.getItem('products') || '[]');
  let users = JSON.parse(localStorage.getItem('users') || '[{user:"admin",pass:"Adalya"}]');

  /* GİRİŞ KONTROLÜ */
  (() => {
    if (localStorage.getItem('giris') !== '1') {
      alert('Yetkisiz erişim');
      window.location.href = 'index.html';
      return;
    }
    const currentUser = localStorage.getItem('currentUser');
    if (currentUser !== 'admin') {
      alert('Sadece admin girebilir');
      window.location.href = 'index.html';
    }
  })();

  /* ÇIKIŞ */
  function cikis() {
    localStorage.removeItem('giris');
    localStorage.removeItem('currentUser');
    window.location.href = 'index.html';
  }

  /* SEKME DEĞİŞTİRME */
  function changeTab(tab) {
    document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelector(`[onclick="changeTab('${tab}')"]`).classList.add('active');
    document.getElementById(tab).classList.add('active');
    renderAll();
  }

  /* RENDER ALL */
  function renderAll() {
    if (currentSection === 'orders') renderOrders();
    if (currentSection === 'products') renderProducts();
    if (currentSection === 'users') renderUsers();
  }

  /* SİPARİŞLER – ÇİZGİLİ TABLO + FİLTRE + SÜTUN TOPLAMLARI + BINLİK AYIRAC */
  function renderOrders() {
    const tbody = document.getElementById('ordersBody');
    tbody.innerHTML = '';
    let tot50 = 0, tot250 = 0, tot1000 = 0, totKoli = 0, totKg = 0;
    const filtered = orders.filter(o =>
      o.customer.toLowerCase().includes(document.getElementById('orderFilter').value.toLowerCase()) ||
      o.code.toLowerCase().includes(document.getElementById('orderFilter').value.toLowerCase())
    );
    filtered.forEach((o, i) => {
      let row50 = 0, row250 = 0, row1000 = 0, rowKoli = 0, rowKg = 0;
      o.items.forEach(it => { row50 += it[50]; row250 += it[250]; row1000 += it[1000]; rowKoli += it.koli; rowKg += it.kg; });
      tot50 += row50; tot250 += row250; tot1000 += row1000; totKoli += rowKoli; totKg += rowKg;
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${o.customer}</td>
        <td>${o.code}</td>
        <td>${o.ship}</td>
        <td style="background:var(--g50)">${row50.toLocaleString('tr-TR')}</td>
        <td style="background:var(--g250)">${row250.toLocaleString('tr-TR')}</td>
        <td style="background:var(--g1000)">${row1000.toLocaleString('tr-TR')}</td>
        <td>${rowKoli.toLocaleString('tr-TR')}</td>
        <td>${rowKg.toLocaleString('tr-TR')}</td>
        <td class="actions">
          <button class="edit-btn" onclick="viewOrder(${i})">Gör</button>
          <button class="edit-btn" onclick="editOrder(${i})">Düzenle</button>
          <button class="del-btn" onclick="deleteOrder(${i})">Sil</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
    // toplam satırı
    const totTr = document.createElement('tr');
    totTr.style.cssText = 'border-top:2px solid var(--border);font-weight:700;color:var(--gold)';
    totTr.innerHTML = `
      <td colspan="3">Toplam</td>
      <td style="background:var(--g50)">${tot50.toLocaleString('tr-TR')}</td>
      <td style="background:var(--g250)">${tot250.toLocaleString('tr-TR')}</td>
      <td style="background:var(--g1000)">${tot1000.toLocaleString('tr-TR')}</td>
      <td>${totKoli.toLocaleString('tr-TR')}</td>
      <td>${totKg.toLocaleString('tr-TR')}</td>
      <td>-</td>
    `;
    tbody.appendChild(totTr);
  }
  function filterOrders() { renderOrders(); }

  /* SİPARİŞ GÖR / DÜZENLE – MODAL BAŞLIK "Kod" + MÜŞTERİ SABİT */
  function viewOrder(idx) {
    const o = orders[idx];
    openModal(`
      <h3>Sipariş Özeti</h3>
      <p><strong>Müşteri:</strong> ${o.customer}</p>
      <p><strong>Kod:</strong> ${o.code}</p>
      <p><strong>Gönderim:</strong> ${o.ship}</p>
      <p><strong>Tarih:</strong> ${o.date}</p>
      <table style="width:100%;font-size:.8rem;border-collapse:collapse;border:1px solid var(--border)">
        <thead><tr><th>Ürün</th><th style="background:var(--g50)">50G</th><th style="background:var(--g250)">250G</th><th style="background:var(--g1000)">1000G</th><th>Koli</th><th>KG</th></tr></thead>
        <tbody>
          ${o.items.map(it => `<tr><td>${it.name}</td><td style="background:var(--g50)">${it[50].toLocaleString('tr-TR')}</td><td style="background:var(--g250)">${it[250].toLocaleString('tr-TR')}</td><td style="background:var(--g1000)">${it[1000].toLocaleString('tr-TR')}</td><td>${it.koli.toLocaleString('tr-TR')}</td><td>${it.kg.toLocaleString('tr-TR')}</td></tr>`).join('')}
        </tbody>
        <tfoot>
          <tr style="border-top:2px solid var(--border);font-weight:700;color:var(--gold)">
            <td colspan="4">Toplam</td>
            <td>${o.items.reduce((a, b) => a + b.koli, 0).toLocaleString('tr-TR')}</td>
            <td>${o.items.reduce((a, b) => a + b.kg, 0).toLocaleString('tr-TR')}</td>
          </tr>
        </tfoot>
      </table>
    `);
  }
  function editOrder(idx) {
    const o = orders[idx];
    openModal(`
      <h3>Kod: ${o.code} – Sipariş Düzenle (Müşteri: ${o.customer})</h3>
      <label>Gönderim</label>
      <select id="editShip"><option value="road" ${o.ship==='Karayolu'?'selected':''}>Karayolu</option><option value="sea" ${o.ship==='Denizyolu'?'selected':''}>Denizyolu</option><option value="air" ${o.ship==='Havayolu'?'selected':''}>Havayolu</option></select>
      <label>Ürün Koli Sayıları (değiştirebilirsiniz)</label>
      <div id="editItems"></div>
    `, `
      <button class="save-btn" onclick="saveEditOrder(${idx})">Kaydet</button>
      <button class="cancel-btn" onclick="closeModal()">İptal</button>
    `);
    // ürün koli girişleri
    const div = document.getElementById('editItems');
    div.innerHTML = o.items.map((it, i) => `
      <div style="display:flex;gap:6px;margin-bottom:6px">
        <span style="flex:1">${it.name}</span>
        <input type="number" min="0" step="1" value="${it[50]}" onchange="updateEditItem(${idx},${i},50,this.value)">
        <input type="number" min="0" step="1" value="${it[250]}" onchange="updateEditItem(${idx},${i},250,this.value)">
        <input type="number" min="0" step="1" value="${it[1000]}" onchange="updateEditItem(${idx},${i},1000,this.value)">
      </div>
    `).join('');
  }
  function updateEditItem(orderIdx, itemIdx, gram, val) {
    orders[orderIdx].items[itemIdx][gram] = Number(val);
    orders[orderIdx].items[itemIdx].koli = orders[orderIdx].items[itemIdx][50] + orders[orderIdx].items[itemIdx][250] + orders[orderIdx].items[itemIdx][1000];
    orders[orderIdx].items[itemIdx].kg = orders[orderIdx].items[itemIdx].koli * KOLI_KG;
  }
  function saveEditOrder(idx) {
    orders[idx].ship = document.getElementById('editShip').selectedOptions[0].text;
    localStorage.setItem('orders', JSON.stringify(orders));
    closeModal();
    renderOrders();
  }
  function deleteOrder(idx) {
    if (!confirm('Silmek istediğinize emin misiniz?')) return;
    orders.splice(idx, 1);
    localStorage.setItem('orders', JSON.stringify(orders));
    renderOrders();
  }

  /* ÜRÜNLER – SIRALAMALI LİSTE + MODAL */
  function renderProducts() {
    const list = document.getElementById('productsList');
    list.innerHTML = '';
    if (products.length === 0) {
      list.innerHTML = `<div style="text-align:center;padding:20px;font-size:.9rem;color:var(--text)">Ürün yok</div>`;
      return;
    }
    products.forEach((p, i) => {
      const item = document.createElement('div');
      item.className = 'item';
      item.draggable = true;
      item.ondragstart = (e) => e.dataTransfer.setData('productIndex', i);
      item.ondragover = (e) => e.preventDefault();
      item.ondrop = (e) => reorderProducts(i, parseInt(e.dataTransfer.getData('productIndex')));
      item.innerHTML = `
        <img src="${p.img}" alt="${p.tr}" onerror="this.src='https://via.placeholder.com/60x60?text=PNG'">
        <div class="info">
          <div class="name">${p.tr}</div>
          <div class="sub">${p.ar} | ${p.en}</div>
        </div>
        <div class="actions">
          <button class="edit-btn" onclick="editProduct(${i})">Düzenle</button>
          <button class="del-btn" onclick="deleteProduct(${i})">Sil</button>
        </div>
      `;
      list.appendChild(item);
    });
  }
  function reorderProducts(to, from) {
    if (to === from) return;
    const [moved] = products.splice(from, 1);
    products.splice(to, 0, moved);
    localStorage.setItem('products', JSON.stringify(products));
    renderProducts();
  }
  function openProductForm(idx = null) {
    const p = idx !== null ? products[idx] : {tr:'',ar:'',en:'',img:''};
    openModal(`
      <h3>${idx !== null ? 'Ürün Düzenle' : 'Yeni Ürün Ekle'}</h3>
      <label>Türkçe İsim</label>
      <input type="text" id="prodTr" value="${p.tr}">
      <label>Arapça İsim</label>
      <input type="text" id="prodAr" value="${p.ar}">
      <label>İngilizce İsim</label>
      <input type="text" id="prodEn" value="${p.en}">
      <label>Resim Yolu (PNG)</label>
      <input type="text" id="prodImg" placeholder="img/urun1.png" value="${p.img}">
    `, `
      <button class="save-btn" onclick="saveProduct(${idx})">Kaydet</button>
      <button class="cancel-btn" onclick="closeModal()">İptal</button>
    `);
  }
  function saveProduct(idx) {
    const p = {
      id: idx !== null ? products[idx].id : Date.now(),
      tr: document.getElementById('prodTr').value.trim(),
      ar: document.getElementById('prodAr').value.trim(),
      en: document.getElementById('prodEn').value.trim(),
      img: document.getElementById('prodImg').value.trim()
    };
    if (!p.tr || !p.ar || !p.en) { alert('İsimler zorunlu'); return; }
    if (idx !== null) products[idx] = p; else products.push(p);
    localStorage.setItem('products', JSON.stringify(products));
    closeModal();
    renderProducts();
  }
  function deleteProduct(idx) {
    if (!confirm('Silmek istediğinize emin misiniz?')) return;
    products.splice(idx, 1);
    localStorage.setItem('products', JSON.stringify(products));
    renderProducts();
  }

  /* KULLANICILAR – VARSAYILAN ŞİFRE "Adalya" */
  function renderUsers() {
    const list = document.getElementById('usersList');
    list.innerHTML = '';
    users.forEach((u, i) => {
      const item = document.createElement('div');
      item.className = 'item';
      item.innerHTML = `
        <div class="info">
          <div class="name">${u.user}</div>
          <div class="sub">${u.user === 'admin' ? 'Yönetici' : 'Kullanıcı'} – Şifre: ${u.pass}</div>
        </div>
        <div class="actions">
          <button class="edit-btn" onclick="resetPassword(${i})">Şifre Sıfırla</button>
          ${u.user !== 'admin' ? `<button class="del-btn" onclick="deleteUser(${i})">Sil</button>` : ''}
        </div>
      `;
      list.appendChild(item);
    });
  }
  function openUserForm() {
    openModal(`
      <h3>Yeni Kullanıcı Ekle</h3>
      <label>Kullanıcı Adı</label>
      <input type="text" id="newUser" placeholder="örn. ahmet">
    `, `
      <button class="save-btn" onclick="saveUser()">Kaydet (şifre: Adalya)</button>
      <button class="cancel-btn" onclick="closeModal()">İptal</button>
    `);
  }
  function saveUser() {
    const u = document.getElementById('newUser').value.trim();
    if (!u) { alert('Kullanıcı adı zorunlu'); return; }
    if (users.find(x => x.user === u)) { alert('Kullanıcı var'); return; }
    users.push({user: u, pass: 'Adalya'});
    localStorage.setItem('users', JSON.stringify(users));
    closeModal();
    renderUsers();
  }
  function resetPassword(idx) {
    const newPass = 'Adalya';
    if (!confirm(`Yeni şifre: ${newPass}\nDevam etmek istiyor musun?`)) return;
    users[idx].pass = newPass;
    localStorage.setItem('users', JSON.stringify(users));
    alert('Şifre sıfırlandı');
    renderUsers();
  }
  function deleteUser(idx) {
    if (!confirm('Silmek istediğinize emin misiniz?')) return;
    users.splice(idx, 1);
    localStorage.setItem('users', JSON.stringify(users));
    renderUsers();
  }

  /* MODAL */
  function openModal(body, footer = '') {
    document.getElementById('modalBody').innerHTML = body;
    document.getElementById('modalFooter').innerHTML = footer;
    document.getElementById('modal').classList.add('show');
  }
  function closeModal() {
    document.getElementById('modal').classList.remove('show');
  }

  /* BAŞLAT */
  window.onload = () => {
    renderOrders();
    renderProducts();
    renderUsers();
  };
</script>

</body>
</html>
