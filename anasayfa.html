<!DOCTYPE html>
<html lang="tr" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Adalya Company ‚Äì Anasayfa</title>

  <style>
    :root{
      --gold:#d4af37;--bg:#f5f7fa;--surface:#fff;--text:#2c3e50;--error:#e74c3c;--border:#e0e0e0;
      --g50:#e8f5e9;--g250:#ffebee;--g1000:#e3f2fd;--total:#fff9c4;
      --radius:16px;--shadow:0 8px 30px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif}
    body{background:var(--bg);color:var(--text)}

    /* √úST BAR + Dƒ∞L */
    .top-bar{display:flex;align-items:center;justify-content:space-between;padding:16px;background:var(--surface);box-shadow:var(--shadow);position:sticky;top:0;z-index:990}
    .logo-name{display:flex;align-items:center;gap:12px}
    .logo-name img{height:48px;border-radius:12px}
    .logo-name .company{font-size:1.2rem;font-weight:700;letter-spacing:.5px}
    .top-actions{display:flex;align-items:center;gap:12px}
    .logout-btn{background:var(--error);color:#fff;border:none;border-radius:var(--radius);padding:10px 16px;font-size:.85rem;font-weight:600;cursor:pointer;transition:background .2s}
    .logout-btn:hover{background:#c0392b}
    .lang-group{display:flex;gap:6px;background:rgba(255,255,255,.85);backdrop-filter:blur(6px);padding:6px;border-radius:30px;box-shadow:0 4px 18px rgba(0,0,0,.15)}
    .lang-group button{min-width:64px;height:40px;border:none;border-radius:20px;font-size:.9rem;font-weight:700;cursor:pointer;background:#fff;color:var(--text);transition:transform .2s}
    .lang-group button:active{transform:scale(.92)}
    .lang-group button.active{background:var(--gold);color:#fff}

    /* ANA ƒ∞√áERƒ∞K */
    .content{padding:16px;max-width:1600px;margin:auto}

    /* Sƒ∞PARƒ∞≈û KODU */
    .order-header{background:var(--surface);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin-bottom:16px;text-align:center}
    .order-code{font-size:1.5rem;font-weight:700;color:var(--gold);letter-spacing:1px}

    /* G√ñNDERƒ∞M ‚Äì 3 ƒ∞KONLU BUTON */
    .gonderim-buttons{display:flex;gap:12px;justify-content:center;margin-bottom:16px}
    .gonderim-btn{flex:1;padding:12px;border:none;border-radius:var(--radius);font-size:1rem;font-weight:600;cursor:pointer;transition:all .3s ease;background:#eee;color:var(--text)}
    .gonderim-btn.active{background:var(--gold);color:#fff;transform:scale(1.05)}
    .gonderim-btn span{font-size:1.4rem;margin-right:6px}

    /* √úR√úN KARTI ‚Äì K√ú√á√úK, 5/SATIR */
    .products-container{display:grid;gap:12px;max-width:1600px;margin:0 auto;grid-template-columns:repeat(5, 1fr);}
    @media (max-width: 1400px){.products-container{grid-template-columns:repeat(4, 1fr);}}
    @media (max-width: 1100px){.products-container{grid-template-columns:repeat(3, 1fr);}}
    @media (max-width: 800px){.products-container{grid-template-columns:repeat(2, 1fr);}}
    @media (max-width: 500px){.products-container{grid-template-columns:1fr;}}

    .product-card{border-radius:var(--radius);overflow:hidden;background:var(--surface);box-shadow:var(--shadow);transition:transform .3s ease, box-shadow .3s ease;will-change:transform;opacity:0;transform:translateY(20px)}
    .product-card.visible{opacity:1;transform:translateY(0)}
    .product-card:hover{transform:translateY(-5px);box-shadow:0 12px 35px rgba(0,0,0,.15)}

    .product-img-box{width:100%;height:120px;display:flex;align-items:center;justify-content:center;background:#f5f7fa;border-top-left-radius:var(--radius);border-top-right-radius:var(--radius);overflow:hidden}
    .product-img{max-width:100%;max-height:100%;object-fit:contain;border-radius:8px}

    .product-name{background:linear-gradient(135deg, var(--gold), #f1c40f);color:#fff;padding:8px 6px;text-align:center;font-weight:700;font-size:0.9rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .product-table{width:100%;border-collapse:collapse;font-size:0.85rem;table-layout:fixed}
    .product-table th,.product-table td{width:33.33%;padding:6px 4px;text-align:center;border:1px solid var(--border);height:32px}
    .product-table th{background:#f8f9fa;font-weight:700;color:var(--text)}
    .product-table tbody tr.gram-50{background:var(--g50)}
    .product-table tbody tr.gram-250{background:var(--g250)}
    .product-table tbody tr.gram-1000{background:var(--g1000)}
    .product-table tfoot td{background:var(--total);font-weight:700;color:var(--text)}

    .koli-input input{width:100%;padding:6px 4px;border:1.4px solid var(--border);border-radius:6px;font-family:'Courier New', monospace;font-size:0.85rem;font-weight:600;text-align:center;direction:ltr;transition:border-color .2s}
    .koli-input input:focus{border-color:var(--gold);outline:none}

    /* ARAMA ‚Äì B√úY√úK + X */
    .search-box{position:relative;max-width:600px;margin:0 auto 24px}
    .search-input{width:100%;padding:14px 48px 14px 16px;border:2px solid var(--border);border-radius:var(--radius);font-size:1.1rem;transition:border-color .2s}
    .search-input:focus{border-color:var(--gold);outline:none}
    .clear-search{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;font-size:1.4rem;color:var(--text);cursor:pointer;padding:4px}

    /* BUTONLAR ‚Äì YUKARIDA */
    .action-buttons{display:flex;gap:12px;margin:24px 0;justify-content:center}
    .btn-modern{display:inline-flex;align-items:center;gap:8px;padding:12px 20px;border:none;border-radius:var(--radius);font-size:1rem;font-weight:600;cursor:pointer;transition:transform .2s}
    .btn-modern:active{transform:scale(.96)}
    .btn-primary{background:var(--gold);color:#fff;box-shadow:0 2px 8px rgba(212,175,55,.3)}
    .btn-secondary{background:#eee;color:var(--text)}

    /* ALT MODAL ‚Äì GENEL TOPLAM */
    .bottom-total{position:fixed;bottom:0;left:0;right:0;background:rgba(255,255,255,.95);backdrop-filter:blur(6px);border-top:2px solid var(--gold);padding:12px 16px;z-index:1000;display:flex;align-items:center;justify-content:space-between;font-size:1rem;font-weight:600;box-shadow:0 -4px 20px rgba(0,0,0,.1)}
    .bottom-total .label{color:var(--gold);}
    .bottom-total .val{font-family:'Courier New', monospace;}

    /* MODAL ‚Äì Sƒ∞PARƒ∞≈û √ñZETƒ∞ */
    .modal{display:none;position:fixed;inset:0;z-index:2000;background:rgba(0,0,0,.45);align-items:center;justify-content:center;padding:16px}
    .modal.show{display:flex}
    .modal-content{background:var(--surface);border-radius:var(--radius);width:100%;max-width:700px;max-height:90vh;overflow-y:auto;box-shadow:0 8px 30px rgba(0,0,0,.2);display:flex;flex-direction:column}
    .modal-header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--border)}
    .modal-header h2{font-size:1.2rem;font-weight:700}
    .close-modal{background:none;border:none;font-size:1.4rem;cursor:pointer;color:var(--text)}
    .modal-body{padding:16px;font-size:.85rem;line-height:1.5;display:flex;flex-direction:column;gap:10px}
    .modal-footer{display:flex;gap:8px;padding:12px 16px;border-top:1px solid var(--border)}
    .modal-footer button{flex:1;padding:10px;border:none;border-radius:var(--radius);font-size:.85rem;font-weight:600;cursor:pointer}
    .save-btn{background:var(--gold);color:#fff}
    .btn-secondary{background:#eee;color:var(--text)}
  </style>
</head>
<body>

<header class="top-bar">
  <div class="logo-name"><img src="img/adalyalogo.jpg" alt="Logo"><span class="company" data-tr="Adalya Company" data-ar="ÿ¥ÿ±ŸÉÿ© ÿ£ÿØÿßŸÑŸäÿß" data-en="Adalya Company">Adalya Company</span></div>
  <div class="top-actions">
    <div class="lang-group">
      <button class="active" onclick="setLang('tr')" title="T√ºrk√ße">T√ºrk√ße</button>
      <button onclick="setLang('ar')" title="ÿßŸÑÿπÿ±ÿ®Ÿäÿ©">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
      <button onclick="setLang('en')" title="English">English</button>
    </div>
    <button class="logout-btn" onclick="cikis()">√áƒ±kƒ±≈ü</button>
  </div>
</header>

<!-- ==========  ANA ƒ∞√áERƒ∞K  ========== -->
<div class="content">

  <!-- 1) Sipari≈ü Kodu -->
  <div class="order-header">
    <div class="order-code" id="orderCode">ADL000</div>
    <div data-tr="Sipari≈ü Kodu" data-ar="ŸÉŸàÿØ ÿßŸÑÿ∑ŸÑÿ®" data-en="Order Code">Sipari≈ü Kodu</div>
  </div>

  <!-- 2) G√∂nderim ‚Äì 3 ƒ∞KONLU BUTON -->
  <div class="gonderim-buttons">
    <button class="gonderim-btn active" data-value="Karayolu" onclick="setGonderim('Karayolu')" data-tr="Karayolu" data-ar="ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ®ÿ±Ÿä" data-en="Road"><span>üöõ</span><span>Karayolu</span></button>
    <button class="gonderim-btn" data-value="Denizyolu" onclick="setGonderim('Denizyolu')" data-tr="Denizyolu" data-ar="ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ®ÿ≠ÿ±Ÿä" data-en="Sea"><span>üö¢</span><span>Denizyolu</span></button>
    <button class="gonderim-btn" data-value="Havayolu" onclick="setGonderim('Havayolu')" data-tr="Havayolu" data-ar="ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ¨ŸàŸä" data-en="Air"><span>‚úàÔ∏è</span><span>Havayolu</span></button>
  </div>

  <!-- 3) ARAMA ‚Äì B√úY√úK + X -->
  <div class="search-box">
    <input id="prodSearch" class="search-input" placeholder="√úr√ºn ara (TR/AR/EN)" oninput="filterProducts()">
    <button class="clear-search" onclick="clearSearch()" title="Temizle">√ó</button>
  </div>

  <!-- 4) √úR√úN KARTLARI ‚Äì 5/SATIR -->
  <section id="products" class="section active">
    <div class="products-container" id="productsList"></div>
  </section>

  <!-- 5) BUTONLAR ‚Äì YUKARIDA -->
  <div class="action-buttons">
    <button class="btn-modern btn-secondary" onclick="newOrder()" data-tr="Yeni Sipari≈ü" data-ar="ÿ∑ŸÑÿ® ÿ¨ÿØŸäÿØ" data-en="New Order">Yeni Sipari≈ü</button>
    <button class="btn-modern btn-primary" onclick="openOrderModal()" data-tr="Sipari≈ü √ñzeti & Kaydet" data-ar="ŸÖŸÑÿÆÿµ ÿßŸÑÿ∑ŸÑÿ® & ÿ≠ŸÅÿ∏" data-en="Order Summary & Save">Sipari≈ü √ñzeti & Kaydet</button>
    <button class="btn-modern btn-secondary" onclick="openMyOrders()" data-tr="Sipari≈ülerim" data-ar="ÿ∑ŸÑÿ®ÿßÿ™Ÿä" data-en="My Orders">Sipari≈ülerim</button>
  </div>

</div>

<!-- ==========  ALT MODAL ‚Äì GENEL TOPLAM  ========== -->
<div class="bottom-total" id="bottomTotal">
  <span class="label" data-tr="Genel Toplam" data-ar="ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑÿπÿßŸÖ" data-en="Grand Total">Genel Toplam</span>
  <span class="val" id="bottomTotalKg">0 kg</span>
</div>

<!-- ==========  MODAL ‚Äì Sƒ∞PARƒ∞≈û √ñZETƒ∞  ========== -->
<div class="modal" id="orderModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 data-tr="Sipari≈ü √ñzeti" data-ar="ŸÖŸÑÿÆÿµ ÿßŸÑÿ∑ŸÑÿ®" data-en="Order Summary">Sipari≈ü √ñzeti</h2>
      <button class="close-modal" onclick="closeOrderModal()">&times;</button>
    </div>
    <div class="modal-body" id="orderModalBody"></div>
    <div class="modal-footer">
      <button class="save-btn" onclick="saveOrder()" data-tr="Kaydet" data-ar="ÿ≠ŸÅÿ∏" data-en="Save">Kaydet</button>
      <button class="btn-secondary" onclick="shareOrder()" data-tr="Payla≈ü" data-ar="ŸÖÿ¥ÿßÿ±ŸÉÿ©" data-en="Share">Payla≈ü</button>
      <button class="btn-secondary" onclick="downloadExcel()" data-tr="Excel ƒ∞ndir" data-ar="ÿ™ÿ≠ŸÖŸäŸÑ ÿ•ŸÉÿ≥ŸÑ" data-en="Download Excel">Excel ƒ∞ndir</button>
      <button class="btn-secondary" onclick="closeOrderModal()" data-tr="Kapat" data-ar="ÿ•ÿ∫ŸÑÿßŸÇ" data-en="Close">Kapat</button>
    </div>
  </div>
</div>

<script>
  /* ----------  TOKEN (Y√∂ntem A)  ---------- */
  let TOKEN = sessionStorage.getItem('ghToken');
  if (!TOKEN) {
    TOKEN = prompt('GitHub Personal Access Token (repo scope):');
    if (TOKEN) sessionStorage.setItem('ghToken', TOKEN);
  }
  const REPO   = 'XwinSherin/adalyacompany';
  const BRANCH = 'main';

  /* ----------  Gƒ∞THUB'A YAZ  ---------- */
  async function writeGitHubFile(path, content, message){
    if (!TOKEN) { alert('Token yok'); return; }
    try {
      const getRes = await fetch(`https://api.github.com/repos/${REPO}/contents/${path}?ref=${BRANCH}`, {
        headers: { 'Authorization': `token ${TOKEN}` }
      });
      let sha = '';
      if (getRes.status === 200) {
        const fileInfo = await getRes.json();
        sha = fileInfo.sha;
      } else if (getRes.status === 404) {
        // dosya yok ‚Üí olu≈ütur
      } else {
        throw new Error('SHA alƒ±namadƒ±: ' + getRes.statusText);
      }
      const encoded = btoa(unescape(encodeURIComponent(content)));
      const putRes = await fetch(`https://api.github.com/repos/${REPO}/contents/${path}`, {
        method : 'PUT',
        headers: { 'Authorization': `token ${TOKEN}`, 'Content-Type': 'application/json' },
        body   : JSON.stringify({ message, content: encoded, sha })
      });
      if (!putRes.ok) {
        const err = await putRes.json();
        throw new Error(err.message || putRes.statusText);
      }
      console.log(`${path} g√ºncellendi`);
      // animasyonlu mesaj
      showToast(message);
    } catch (err) {
      console.error(err);
      alert('Yazma hatasƒ±: ' + err.message);
    }
  }

  /* ----------  DEƒûƒ∞≈ûKENLER  ---------- */
  let products   = [];
  let orders     = [];
  let currentOrder = {};
  const KOLI_KG  = 6;
  let gonderim   = 'Karayolu';

  /* ----------  Gƒ∞Rƒ∞≈û KONTROL√ú  ---------- */
  (()=>{
    if(sessionStorage.getItem('role')!=='user'){ location.href='index.html'; }
    document.getElementById('userName').textContent=sessionStorage.getItem('currentUser')||'Bayi';
  })();

  /* ----------  √áIKI≈û  ---------- */
  function cikis(){
    sessionStorage.clear();
    location.href='index.html';
  }

  /* ----------  Dƒ∞L ‚Äì TAMAM (ARAP√áA SAYILAR DAHƒ∞L)  ---------- */
  function setLang(lang){
    localStorage.setItem('lang',lang);
    document.documentElement.lang=lang;
    document.documentElement.dir=(lang==='ar'?'rtl':'ltr');
    // metinler
    document.querySelectorAll('[data-tr]').forEach(el=>el.textContent=el.dataset[lang]||el.dataset.tr);
    // g√∂nderim butonlarƒ±
    document.querySelectorAll('.gonderim-btn').forEach(btn=>{
      const val = btn.dataset.value;
      const trMap = {Karayolu:'Karayolu',Denizyolu:'Denizyolu',Havayolu:'Havayolu'};
      const arMap = {Karayolu:'ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ®ÿ±Ÿä',Denizyolu:'ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ®ÿ≠ÿ±Ÿä',Havayolu:'ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ¨ŸàŸä'};
      const enMap = {Karayolu:'Road',Denizyolu:'Sea',Havayolu:'Air'};
      const map = lang==='ar'?arMap:lang==='en'?enMap:trMap;
      btn.innerHTML = `<span>${btn.querySelector('span:first-child').textContent}</span><span>${map[val]}</span>`;
    });
    // alt toplam
    const kg = document.getElementById('bottomTotalKg').textContent.replace(/[^0-9]/g,'');
    document.getElementById('bottomTotalKg').textContent = lang==='ar'? kg + ' ŸÉÿ∫' : lang==='en'? kg + ' kg' : kg + ' kg';
    document.querySelector('.bottom-total .label').textContent = lang==='ar'?'ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑÿπÿßŸÖ':lang==='en'?'Grand Total':'Genel Toplam';
    // lang butonlarƒ±
    document.querySelectorAll('.lang-group button').forEach(b=>b.classList.toggle('active',b.title.includes(lang==='ar'?'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©':lang==='en'?'English':'T√ºrk√ße')));
  }

  /* ----------  ARAMA ‚Äì B√úY√úK + X  ---------- */
  function clearSearch(){
    document.getElementById('prodSearch').value='';
    filterProducts();
  }
  function filterProducts(){
    const search = document.getElementById('prodSearch').value.toLowerCase();
    document.querySelectorAll('.product-card').forEach(card=>{
      const name = card.querySelector('.product-name').textContent.toLowerCase();
      card.style.display = name.includes(search) ? 'block' : 'none';
    });
  }

  /* ----------  G√ñNDERƒ∞M  ---------- */
  function setGonderim(val){
    gonderim = val;
    document.querySelectorAll('.gonderim-btn').forEach(b=>b.classList.remove('active'));
    document.querySelector(`[data-value="${val}"]`).classList.add('active');
  }

  /* ----------  YENƒ∞ Sƒ∞PARƒ∞≈û ‚Äì SIFIRLAMA  ---------- */
  function newOrder(){
    document.querySelectorAll('.koli-input input').forEach(inp=>{
      inp.value='';
      inp.dispatchEvent(new Event('input'));
    });
    generateOrderCode();
    updateBottomTotal();
  }

  /* ----------  Sƒ∞PARƒ∞≈û KODU  ---------- */
  function generateOrderCode(){
    const user = sessionStorage.getItem('currentUser')||'ADL';
    const today = new Date();
    const dateStr = today.getDate().toString().padStart(2,'0') + (today.getMonth()+1).toString().padStart(2,'0') + today.getFullYear().toString().slice(-2);
    const lastOrder = orders.length ? orders[orders.length - 1] : { code: user + dateStr + '000' };
    const lastNum = parseInt(lastOrder.code.slice(-3), 10);
    const newNum  = String(lastNum + 1).padStart(3, '0');
    document.getElementById('orderCode').textContent = user + dateStr + newNum;
  }

  /* ----------  ANLIK KG + TOPLAM  ---------- */
  function updateKg(input, gram, idx) {
    const val  = Math.max(0, parseInt(input.value) || 0);
    const kg   = val * KOLI_KG;
    const card = input.closest('.product-card');
    card.querySelector(`.kg-${gram}`).textContent = kg.toLocaleString('tr-TR');

    const k50   = parseInt(card.querySelector('.kg-50').textContent.replace(/\./g,'')  || 0);
    const k250  = parseInt(card.querySelector('.kg-250').textContent.replace(/\./g,'') || 0);
    const k1000 = parseInt(card.querySelector('.kg-1000').textContent.replace(/\./g,'')|| 0);
    const totKg   = k50 + k250 + k1000;
    const totKoli = totKg / KOLI_KG;

    card.querySelector('.total-koli').textContent = totKoli.toLocaleString('tr-TR');
    card.querySelector('.total-kg').textContent   = totKg.toLocaleString('tr-TR');
    updateBottomTotal();
  }

  /* ----------  MODAL ‚Äì Sƒ∞PARƒ∞≈û √ñZETƒ∞  ---------- */
  function openOrderModal(){
    const code = document.getElementById('orderCode').textContent;
    const body = document.getElementById('orderModalBody');
    body.innerHTML = `
      <p><strong>Sipari≈ü Kodu:</strong> ${code}</p>
      <p><strong>G√∂nderim:</strong> ${gonderim}</p>
      <table class="product-table" id="orderModalTable"></table>
      <div class="toplamlar">
        <p><strong>Toplam 50G:</strong> <span id="modal50"></span> kg</p>
        <p><strong>Toplam 250G:</strong> <span id="modal250"></span> kg</p>
        <p><strong>Toplam 1000G:</strong> <span id="modal1000"></span> kg</p>
        <p><strong>Toplam Koli:</strong> <span id="modalKoli"></span></p>
        <p><strong>Genel Toplam:</strong> <span id="modalTotal"></span> kg</p>
      </div>
    `;
    let m50=0, m250=0, m1000=0, mkoli=0;
    document.querySelectorAll('.product-card').forEach(card=>{
      const k50   = parseInt(card.querySelector('.kg-50').textContent.replace(/\./g,'')  || 0);
      const k250  = parseInt(card.querySelector('.kg-250').textContent.replace(/\./g,'') || 0);
      const k1000 = parseInt(card.querySelector('.kg-1000').textContent.replace(/\./g,'')|| 0);
      const tr = card.querySelector('.product-name').dataset.tr;
      if(k50>0)  document.getElementById('orderModalTable').innerHTML+=`<tr class="gram-50"><td>${tr}</td><td>50G</td><td>${(k50/6).toLocaleString('tr-TR')}</td><td>${k50.toLocaleString('tr-TR')}</td></tr>`;
      if(k250>0) document.getElementById('orderModalTable').innerHTML+=`<tr class="gram-250"><td>${tr}</td><td>250G</td><td>${(k250/6).toLocaleString('tr-TR')}</td><td>${k250.toLocaleString('tr-TR')}</td></tr>`;
      if(k1000>0)document.getElementById('orderModalTable').innerHTML+=`<tr class="gram-1000"><td>${tr}</td><td>1000G</td><td>${(k1000/6).toLocaleString('tr-TR')}</td><td>${k1000.toLocaleString('tr-TR')}</td></tr>`;
      m50+=k50; m250+=k250; m1000+=k1000; mkoli+=(k50+k250+k1000)/6;
    });
    document.getElementById('modal50').textContent   = m50.toLocaleString('tr-TR');
    document.getElementById('modal250').textContent  = m250.toLocaleString('tr-TR');
    document.getElementById('modal1000').textContent = m1000.toLocaleString('tr-TR');
    document.getElementById('modalKoli').textContent = mkoli.toLocaleString('tr-TR');
    document.getElementById('modalTotal').textContent= (m50+m250+m1000).toLocaleString('tr-TR');
    document.getElementById('orderModal').classList.add('show');
  }
  function closeOrderModal(){
    document.getElementById('orderModal').classList.remove('show');
  }

  /* ----------  Sƒ∞PARƒ∞≈û KAYDET  ---------- */
  async function saveOrder(){
    const code = document.getElementById('orderCode').textContent;
    const items = [];
    document.querySelectorAll('.product-card').forEach(card=>{
      const k50   = parseInt(card.querySelector('.kg-50').textContent.replace(/\./g,'')  || 0);
      const k250  = parseInt(card.querySelector('.kg-250').textContent.replace(/\./g,'') || 0);
      const k1000 = parseInt(card.querySelector('.kg-1000').textContent.replace(/\./g,'')|| 0);
      const name  = card.querySelector('.product-name').dataset.tr;
      if(k50+k250+k1000===0) return;
      items.push({
        name: name,
        50: k50/6,
        250: k250/6,
        1000: k1000/6,
        koli: (k50+k250+k1000)/6,
        kg: k50+k250+k1000
      });
    });
    if(items.length===0){ alert('En az bir √ºr√ºn girin!'); return; }
    const order = {
      customer: sessionStorage.getItem('currentUser')||'Bayi',
      code: code,
      ship: gonderim,
      date: new Date().toISOString(),
      items: items
    };
    orders.push(order);
    await writeGitHubFile('orders.json', JSON.stringify(orders, null, 2), `Sipari≈ü eklendi: ${code}`);
    closeOrderModal();
    newOrder();
  }

  /* ----------  PAYLA≈û  ---------- */
  function shareOrder(){
    const code = document.getElementById('orderCode').textContent;
    const text = `Sipari≈ü Kodu: ${code}\nG√∂nderim: ${gonderim}\nToplam: ${document.getElementById('bottomTotalKg').textContent}`;
    const url  = `https://wa.me/?text=${encodeURIComponent(text)}`;
    window.open(url, '_blank');
  }

  /* ----------  EXCEL ƒ∞NDƒ∞R  ---------- */
  function downloadExcel(){
    const code = document.getElementById('orderCode').textContent;
    let csv = '√úr√ºn,Gramaj,Koli,Kg\n';
    document.querySelectorAll('#orderModalTable tr').forEach(row=>{
      const cells = row.querySelectorAll('td');
      if(cells.length===4) csv += cells[0].textContent + ',' + cells[1].textContent + ',' + cells[2].textContent + ',' + cells[3].textContent + '\n';
    });
    const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = code + '.csv';
    link.click();
  }

  /* ----------  Sƒ∞PARƒ∞≈ûLERƒ∞M  ---------- */
  async function openMyOrders(){
    const res = await fetch('https://raw.githubusercontent.com/XwinSherin/adalyacompany/main/orders.json');
    const allOrders = await res.json();
    const myOrders = allOrders.filter(o => o.customer === (sessionStorage.getItem('currentUser')||'Bayi'));
    const body = document.getElementById('orderModalBody');
    body.innerHTML = '';
    if(myOrders.length===0){ body.innerHTML = '<p>Hen√ºz sipari≈üiniz yok.</p>'; }
    else {
      myOrders.forEach((o, i) => {
        body.innerHTML += `
          <div style="border:1px solid var(--border);border-radius:var(--radius);padding:12px;margin-bottom:12px;">
            <p><strong>Sipari≈ü Kodu:</strong> ${o.code}</p>
            <p><strong>G√∂nderim:</strong> ${o.ship}</p>
            <p><strong>Tarih:</strong> ${new Date(o.date).toLocaleString('tr-TR')}</p>
            <p><strong>Toplam Kg:</strong> ${o.items.reduce((a,b)=>a+b.kg,0).toLocaleString('tr-TR')} kg</p>
            <div class="actions"><button class="edit-btn" onclick="viewOrder(${i})">G√∂r</button><button class="btn-secondary" onclick="shareOrderFromList(${i})">Payla≈ü</button><button class="del-btn" onclick="deleteOrder(${i})">Sil</button></div>
          </div>
        `;
      });
    }
    document.getElementById('orderModal').classList.add('show');
  }
  function viewOrder(idx){
    const order = orders[idx];
    if(!order) return;
    const body = document.getElementById('orderModalBody');
    body.innerHTML = `
      <p><strong>Sipari≈ü Kodu:</strong> ${order.code}</p>
      <p><strong>G√∂nderim:</strong> ${order.ship}</p>
      <p><strong>Tarih:</strong> ${new Date(order.date).toLocaleString('tr-TR')}</p>
      <table class="product-table">
        <thead><tr><th>√úr√ºn</th><th>Gramaj</th><th>Koli</th><th>Kg</th></tr></thead>
        <tbody id="viewModalTable"></tbody>
      </table>
      <p><strong>Toplam Kg:</strong> ${order.items.reduce((a,b)=>a+b.kg,0).toLocaleString('tr-TR')} kg</p>
    `;
    document.getElementById('viewModalTable').innerHTML = order.items.map(it=>`<tr class="gram-${Object.keys(it).find(g=>['50','250','1000'].includes(g))}"><td>${it.name}</td><td>${Object.keys(it).find(g=>['50','250','1000'].includes(g))}G</td><td>${it.koli.toLocaleString('tr-TR')}</td><td>${it.kg.toLocaleString('tr-TR')}</td></tr>`).join('');
    document.getElementById('orderModal').classList.add('show');
  }
  function shareOrderFromList(idx){
    const order = orders[idx];
    const text = `Sipari≈ü Kodu: ${order.code}\nG√∂nderim: ${order.ship}\nToplam: ${order.items.reduce((a,b)=>a+b.kg,0).toLocaleString('tr-TR')} kg`;
    const url  = `https://wa.me/?text=${encodeURIComponent(text)}`;
    window.open(url, '_blank');
  }
  async function deleteOrder(idx){
    if(!confirm('Silmek istediƒüinize emin misiniz?')) return;
    const code = orders[idx].code;
    orders.splice(idx, );
