<!DOCTYPE html>
<html lang="tr" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Adalya Company ‚Äì Anasayfa</title>

  <style>
    :root{
      --gold:#d4af37;--bg:#f5f7fa;--surface:#fff;--text:#2c3e50;--error:#e74c3c;--border:#e0e0e0;
      --g50:#e8f5e9;--g250:#ffebee;--g1000:#e3f2fd;--total:#fff9c4;
      --radius:16px;--shadow:0 8px 30px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif}
    body{background:var(--bg);color:var(--text)}

    /* √úST BAR */
    .top-bar{display:flex;align-items:center;justify-content:space-between;padding:16px;background:var(--surface);box-shadow:var(--shadow);position:sticky;top:0;z-index:990}
    .logo-name{display:flex;align-items:center;gap:12px}
    .logo-name img{height:48px;border-radius:12px}
    .logo-name .company{font-size:1.2rem;font-weight:700;letter-spacing:.5px}
    .logout-btn{background:var(--error);color:#fff;border:none;border-radius:var(--radius);padding:10px 16px;font-size:.85rem;font-weight:600;cursor:pointer;transition:background .2s}
    .logout-btn:hover{background:#c0392b}
    .user-info{display:flex;align-items:center;gap:8px;font-size:.9rem;font-weight:600}

    /* Dƒ∞L BUTONLARI */
    .lang-float{position:fixed;bottom:16px;right:16px;z-index:999;display:flex;gap:6px;background:rgba(255,255,255,.85);backdrop-filter:blur(6px);padding:6px;border-radius:30px;box-shadow:0 4px 18px rgba(0,0,0,.15)}
    .lang-float button{min-width:64px;height:40px;border:none;border-radius:20px;font-size:.9rem;font-weight:700;cursor:pointer;background:#fff;color:var(--text);transition:transform .2s}
    .lang-float button:active{transform:scale(.92)}
    .lang-float button.active{background:var(--gold);color:#fff}

    /* √úR√úN KARTI */
    .products-container{display:grid;gap:18px;max-width:1600px;margin:0 auto;grid-template-columns:repeat(auto-fill, minmax(300px, 1fr))}
    .product-card{border-radius:var(--radius);overflow:hidden;background:var(--surface);box-shadow:var(--shadow);transition:transform .3s ease, box-shadow .3s ease;will-change:transform;opacity:0;transform:translateY(20px)}
    .product-card.visible{opacity:1;transform:translateY(0)}
    .product-card:hover{transform:translateY(-5px);box-shadow:0 12px 35px rgba(0,0,0,.15)}
    .product-img{width:100%;height:120px;object-fit:cover;border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}
    .product-name{background:linear-gradient(135deg, #4facfe, #00f2fe);color:#fff;padding:10px 8px;text-align:center;font-weight:700;font-size:1rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .product-table{width:100%;border-collapse:collapse;font-size:0.9rem;table-layout:fixed}
    .product-table th,.product-table td{width:33.33%;padding:8px 4px;text-align:center;border:1px solid var(--border);height:36px}
    .product-table th{background:#f8f9fa;font-weight:700;color:var(--text)}
    .product-table tbody tr.gram-50{background:var(--g50)}
    .product-table tbody tr.gram-250{background:var(--g250)}
    .product-table tbody tr.gram-1000{background:var(--g1000)}
    .product-table tfoot td{background:var(--total);font-weight:700;color:var(--text)}

    .koli-input input{width:100%;padding:6px 4px;border:1.4px solid var(--border);border-radius:6px;font-family:'Courier New', monospace;font-size:0.9rem;font-weight:600;text-align:center;direction:ltr;transition:border-color .2s}
    .koli-input input:focus{border-color:var(--gold);outline:none}

    .gonderim-secimi{margin-top:24px;text-align:center}
    .gonderim-select{padding:10px 14px;border-radius:var(--radius);border:1.5px solid var(--border);font-size:1rem;background:var(--surface);cursor:pointer}
  </style>
</head>
<body>

<header class="top-bar">
  <div class="logo-name"><img src="img/adalyalogo.jpg" alt="Logo"><span class="company" data-tr="Adalya Company" data-ar="ÿ¥ÿ±ŸÉÿ© ÿ£ÿØÿßŸÑŸäÿß" data-en="Adalya Company">Adalya Company</span></div>
  <div class="user-info"><span id="userName"></span><button class="logout-btn" onclick="cikis()">√áƒ±kƒ±≈ü</button></div>
</header>

<!-- ==========  √úR√úN KARTI  ========== -->
<section id="products" class="section active">
  <h3 data-tr="√úr√ºnler" data-ar="ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™" data-en="Products">√úr√ºnler</h3>
  <input id="prodSearch" class="filter-input" placeholder="√úr√ºn ara (TR/AR/EN)" oninput="filterProducts()">
  <div class="products-container" id="productsList"></div>
  <div class="gonderim-secimi">
    <select id="gonderimSelect">
      <option value="Karayolu" selected data-tr="Karayolu" data-ar="ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ®ÿ±Ÿä" data-en="Road">üöõ Karayolu</option>
      <option value="Denizyolu" data-tr="Denizyolu" data-ar="ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ®ÿ≠ÿ±Ÿä" data-en="Sea">üö¢ Denizyolu</option>
      <option value="Havayolu" data-tr="Havayolu" data-ar="ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ¨ŸàŸä" data-en="Air">‚úàÔ∏è Havayolu</option>
    </select>
  </div>
</section>

<!-- ==========  Dƒ∞L BUTONLARI  ========== -->
<div class="lang-float">
  <button class="active" onclick="setLang('tr')" title="T√ºrk√ße">T√ºrk√ße</button>
  <button onclick="setLang('ar')" title="ÿßŸÑÿπÿ±ÿ®Ÿäÿ©">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
  <button onclick="setLang('en')" title="English">English</button>
</div>

<script>
  /* ----------  TOKEN (Y√∂ntem A)  ---------- */
  let TOKEN = sessionStorage.getItem('ghToken');
  if (!TOKEN) {
    TOKEN = prompt('GitHub Personal Access Token (repo scope):');
    if (TOKEN) sessionStorage.setItem('ghToken', TOKEN);
  }
  const REPO   = 'XwinSherin/adalyacompany';
  const BRANCH = 'main';

  /* ----------  Gƒ∞THUB'A YAZ  ---------- */
  async function writeGitHubFile(path, content, message){
    if (!TOKEN) { alert('Token yok'); return; }
    try {
      const getRes = await fetch(`https://api.github.com/repos/${REPO}/contents/${path}?ref=${BRANCH}`, {
        headers: { 'Authorization': `token ${TOKEN}` }
      });
      let sha = '';
      if (getRes.status === 200) {
        const fileInfo = await getRes.json();
        sha = fileInfo.sha;
      } else if (getRes.status === 404) {
        // dosya yok ‚Üí olu≈ütur
      } else {
        throw new Error('SHA alƒ±namadƒ±: ' + getRes.statusText);
      }
      const encoded = btoa(unescape(encodeURIComponent(content)));
      const putRes = await fetch(`https://api.github.com/repos/${REPO}/contents/${path}`, {
        method : 'PUT',
        headers: { 'Authorization': `token ${TOKEN}`, 'Content-Type': 'application/json' },
        body   : JSON.stringify({ message, content: encoded, sha })
      });
      if (!putRes.ok) {
        const err = await putRes.json();
        throw new Error(err.message || putRes.statusText);
      }
      console.log(`${path} g√ºncellendi`);
      alert(`${path} ba≈üarƒ±yla GitHub‚Äôa yazƒ±ldƒ±!`);
    } catch (err) {
      console.error(err);
      alert('Yazma hatasƒ±: ' + err.message);
    }
  }

  /* ----------  DEƒûƒ∞≈ûKENLER  ---------- */
  let products = [];
  let orders   = [];
  const KOLI_KG = 6;

  /* ----------  Gƒ∞Rƒ∞≈û KONTROL√ú  ---------- */
  (()=>{
    if(sessionStorage.getItem('role')!=='user'){ location.href='index.html'; }
    document.getElementById('userName').textContent=sessionStorage.getItem('currentUser')||'Bayi';
  })();

  /* ----------  √áIKI≈û  ---------- */
  function cikis(){
    sessionStorage.clear();
    location.href='index.html';
  }

  /* ----------  Dƒ∞L  ---------- */
  function setLang(lang){
    localStorage.setItem('lang',lang);
    document.documentElement.lang=lang;
    document.documentElement.dir=(lang==='ar'?'rtl':'ltr');
    document.querySelectorAll('[data-tr]').forEach(el=>el.textContent=el.dataset[lang]||el.dataset.tr);
    document.querySelectorAll('.gonderim-select option').forEach(opt=>opt.textContent=opt.dataset[lang]||opt.dataset.tr);
    document.querySelectorAll('.lang-float button').forEach(b=>b.classList.toggle('active',b.title.includes(lang==='ar'?'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©':lang==='en'?'English':'T√ºrk√ße')));
  }

  /* ----------  √úR√úN √áEK  ---------- */
  async function loadProducts(){
    const res = await fetch('https://raw.githubusercontent.com/XwinSherin/adalyacompany/main/products.json');
    products = await res.json();
    products = products.filter(p => p.active !== false);
    renderProducts();
  }

  /* ----------  √úR√úN G√ñSTER  ---------- */
  function renderProducts(){
    const list = document.getElementById('productsList');
    list.innerHTML = '';
    const search = document.getElementById('prodSearch').value.toLowerCase();
    const filtered = products.filter(p =>
      p.tr.toLowerCase().includes(search) ||
      p.ar.toLowerCase().includes(search) ||
      p.en.toLowerCase().includes(search)
    );
    filtered.forEach((p, i) => {
      const card = document.createElement('div');
      card.className = 'product-card';
      card.innerHTML = `
        <img class="product-img" src="https://raw.githubusercontent.com/XwinSherin/adalyacompany/main/${p.img}" alt="${p.tr}" onerror="this.src='https://via.placeholder.com/300x120?text=PNG'">
        <div class="product-name" data-tr="${p.tr}" data-ar="${p.ar}" data-en="${p.en}">${p.tr}</div>
        <table class="product-table">
          <thead><tr><th>Gramaj</th><th>Koli</th><th>Kg</th></tr></thead>
          <tbody>
            <tr class="gram-50"><td>50G</td><td class="koli-input"><input type="number" min="0" max="99999" placeholder="0" oninput="updateKg(this, 50, ${i})"></td><td class="kg-50">0</td></tr>
            <tr class="gram-250"><td>250G</td><td class="koli-input"><input type="number" min="0" max="99999" placeholder="0" oninput="updateKg(this, 250, ${i})"></td><td class="kg-250">0</td></tr>
            <tr class="gram-1000"><td>1000G</td><td class="koli-input"><input type="number" min="0" max="99999" placeholder="0" oninput="updateKg(this, 1000, ${i})"></td><td class="kg-1000">0</td></tr>
          </tbody>
          <tfoot><tr><td>Toplam</td><td class="total-koli">0</td><td class="total-kg">0</td></tr></tfoot>
        </table>
      `;
      list.appendChild(card);
      setTimeout(() => card.classList.add('visible'), i * 50);
    });
  }

  /* ----------  ANLIK KG + TOPLAM  ---------- */
  function updateKg(input, gram, idx) {
    const val  = Math.max(0, parseInt(input.value) || 0);
    const kg   = val * KOLI_KG;
    const card = input.closest('.product-card');
    card.querySelector(`.kg-${gram}`).textContent = kg.toLocaleString('tr-TR');

    const k50   = parseInt(card.querySelector('.kg-50').textContent.replace(/\./g,''))  || 0;
    const k250  = parseInt(card.querySelector('.kg-250').textContent.replace(/\./g,'')) || 0;
    const k1000 = parseInt(card.querySelector('.kg-1000').textContent.replace(/\./g,''))|| 0;
    const totKg   = k50 + k250 + k1000;
    const totKoli = totKg / KOLI_KG;

    card.querySelector('.total-koli').textContent = totKoli.toLocaleString('tr-TR');
    card.querySelector('.total-kg').textContent   = totKg.toLocaleString('tr-TR');
  }

  /* ----------  BA≈ûLAT  ---------- */
  window.onload=()=>{
    setLang(localStorage.getItem('lang')||'tr');
    loadProducts();
  };
</script>

</body>
</html>
